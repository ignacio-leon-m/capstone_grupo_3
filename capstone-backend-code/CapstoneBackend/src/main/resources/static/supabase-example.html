<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrainBoost - Demo Supabase</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .demo-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .result-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            max-height: 400px;
            overflow-y: auto;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .btn-custom {
            margin: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>üöÄ Demo de Conexi√≥n a Supabase</h1>
        <p class="text-muted">Ejemplos de operaciones CRUD con tu base de datos Supabase</p>

        <hr>

        <!-- Autenticaci√≥n -->
        <section class="mb-4">
            <h3>üîê Autenticaci√≥n</h3>
            <div class="mb-3">
                <input type="email" id="loginEmail" class="form-control mb-2" placeholder="Email">
                <input type="password" id="loginPassword" class="form-control mb-2" placeholder="Contrase√±a">
                <button onclick="testLogin()" class="btn btn-primary btn-custom">Iniciar Sesi√≥n</button>
                <button onclick="testLogout()" class="btn btn-secondary btn-custom">Cerrar Sesi√≥n</button>
            </div>
            <div id="authResult" class="result-box"></div>
        </section>

        <!-- SELECT -->
        <section class="mb-4">
            <h3>üìã Consultar Datos (SELECT)</h3>
            <div class="mb-3">
                <input type="text" id="tableName" class="form-control mb-2" placeholder="Nombre de tabla (ej: users)" value="users">
                <button onclick="testSelect()" class="btn btn-success btn-custom">Consultar Todos</button>
                <button onclick="testSelectFiltered()" class="btn btn-info btn-custom">Consultar Filtrado</button>
            </div>
            <div id="selectResult" class="result-box"></div>
        </section>

        <!-- INSERT -->
        <section class="mb-4">
            <h3>‚ûï Insertar Datos (INSERT)</h3>
            <div class="mb-3">
                <textarea id="insertData" class="form-control mb-2" rows="4" placeholder='{"name": "Test User", "email": "test@example.com"}'></textarea>
                <button onclick="testInsert()" class="btn btn-primary btn-custom">Insertar</button>
            </div>
            <div id="insertResult" class="result-box"></div>
        </section>

        <!-- UPDATE -->
        <section class="mb-4">
            <h3>‚úèÔ∏è Actualizar Datos (UPDATE)</h3>
            <div class="mb-3">
                <input type="number" id="updateId" class="form-control mb-2" placeholder="ID del registro">
                <textarea id="updateData" class="form-control mb-2" rows="3" placeholder='{"name": "Nombre Actualizado"}'></textarea>
                <button onclick="testUpdate()" class="btn btn-warning btn-custom">Actualizar</button>
            </div>
            <div id="updateResult" class="result-box"></div>
        </section>

        <!-- DELETE -->
        <section class="mb-4">
            <h3>üóëÔ∏è Eliminar Datos (DELETE)</h3>
            <div class="mb-3">
                <input type="number" id="deleteId" class="form-control mb-2" placeholder="ID del registro a eliminar">
                <button onclick="testDelete()" class="btn btn-danger btn-custom">Eliminar</button>
            </div>
            <div id="deleteResult" class="result-box"></div>
        </section>

        <!-- Estado de Conexi√≥n -->
        <section class="mb-4">
            <h3>üìä Estado de la Conexi√≥n</h3>
            <div id="connectionStatus" class="alert alert-info">
                <strong>URL:</strong> https://dynehineagvxftqchjwz.supabase.co<br>
                <strong>Estado:</strong> <span id="statusText">Listo para conectar</span>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="/js/supabase-client.js"></script>
    <script src="/js/supabase-auth.js"></script>
    <script>
        // Funci√≥n auxiliar para mostrar resultados
        function showResult(elementId, data, error = null) {
            const element = document.getElementById(elementId);
            if (error) {
                element.innerHTML = `<pre style="color: red;"><strong>Error:</strong>\n${JSON.stringify(error, null, 2)}</pre>`;
            } else {
                element.innerHTML = `<pre style="color: green;"><strong>√âxito:</strong>\n${JSON.stringify(data, null, 2)}</pre>`;
            }
        }

        // Test de autenticaci√≥n
        async function testLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showResult('authResult', null, 'Por favor ingresa email y contrase√±a');
                return;
            }

            const { user, token, error } = await supabaseAuth.signIn(email, password);
            
            if (error) {
                showResult('authResult', null, error);
            } else {
                showResult('authResult', { user, token: token.substring(0, 50) + '...' });
            }
        }

        function testLogout() {
            supabaseAuth.signOut();
        }

        // Test SELECT
        async function testSelect() {
            const table = document.getElementById('tableName').value;
            const { data, error } = await supabase.select(table, { limit: 5 });
            showResult('selectResult', data, error);
        }

        async function testSelectFiltered() {
            const table = document.getElementById('tableName').value;
            const { data, error } = await supabase.select(table, {
                select: 'id,name,email',
                filter: { role: 'estudiante' },
                limit: 3
            });
            showResult('selectResult', data, error);
        }

        // Test INSERT
        async function testInsert() {
            const table = document.getElementById('tableName').value;
            const dataStr = document.getElementById('insertData').value;
            
            try {
                const data = JSON.parse(dataStr);
                const { data: result, error } = await supabase.insert(table, data);
                showResult('insertResult', result, error);
            } catch (e) {
                showResult('insertResult', null, 'JSON inv√°lido: ' + e.message);
            }
        }

        // Test UPDATE
        async function testUpdate() {
            const table = document.getElementById('tableName').value;
            const id = document.getElementById('updateId').value;
            const dataStr = document.getElementById('updateData').value;
            
            try {
                const data = JSON.parse(dataStr);
                const { data: result, error } = await supabase.update(table, data, { id });
                showResult('updateResult', result, error);
            } catch (e) {
                showResult('updateResult', null, 'JSON inv√°lido: ' + e.message);
            }
        }

        // Test DELETE
        async function testDelete() {
            const table = document.getElementById('tableName').value;
            const id = document.getElementById('deleteId').value;
            
            if (!id) {
                showResult('deleteResult', null, 'Por favor ingresa un ID');
                return;
            }

            const { data, error } = await supabase.delete(table, { id });
            showResult('deleteResult', data, error);
        }

        // Verificar conexi√≥n al cargar
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Intentar una consulta simple
                const { data, error } = await supabase.select('users', { limit: 1 });
                
                if (error) {
                    document.getElementById('statusText').textContent = '‚ùå Error de conexi√≥n';
                    document.getElementById('connectionStatus').className = 'alert alert-danger';
                } else {
                    document.getElementById('statusText').textContent = '‚úÖ Conectado correctamente';
                    document.getElementById('connectionStatus').className = 'alert alert-success';
                }
            } catch (e) {
                document.getElementById('statusText').textContent = '‚ùå Error: ' + e.message;
                document.getElementById('connectionStatus').className = 'alert alert-danger';
            }
        });
    </script>
</body>
</html>
