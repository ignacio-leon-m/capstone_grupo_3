<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BrainBoost - Crear Profesor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link rel="stylesheet" href="/css/home.css" />
    <link rel="stylesheet" href="/css/forms.css" />
    <link rel="icon" href="/images/bb-logo.png" />
</head>
<body>
    <header class="main-header">
        <img src="/images/bb-logo.png" alt="BrainBoost Logo" class="logo" />
    </header>

    <div class="container">
        <a href="/home.html" class="back-button" title="Volver a Inicio"><i class="fas fa-arrow-left"></i></a>
        <div class="content-box">
            <h1 class="welcome-message">Crear Nuevo Profesor</h1>
            <p class="instruction">Completa los datos para registrar un profesor.</p>
            <form id="crearProfesorForm" class="form-container">
                <div class="input-group">
                    <label for="name">Nombre</label>
                    <input type="text" id="name" name="name" required />
                </div>
                <div class="input-group">
                    <label for="lastName">Apellido</label>
                    <input type="text" id="lastName" name="lastName" required />
                </div>
                <div class="input-group">
                    <label for="email">Correo Electrónico</label>
                    <input type="email" id="email" name="email" required />
                </div>
                <div class="input-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" name="password" required />
                </div>
                <button type="submit" class="submit-button">Crear Profesor</button>
            </form>
        </div>
    </div>

    <div class="logout-fixed-container">
        <a href="#" id="logout-button" class="logout-icon-button" title="Cerrar Sesión">
            <i class="fas fa-power-off"></i>
            <span class="logout-tooltip">Cerrar Sesión</span>
        </a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('jwtToken');
            const role = localStorage.getItem('userRole');

            if (!token) {
                window.location.href = '/index.html';
                return;
            }

            if (role !== 'admin') {
                alert('Acceso denegado. Solo los administradores pueden crear profesores.');
                window.location.href = '/home.html';
                return;
            }

            const form = document.getElementById('crearProfesorForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const payload = {
                    name: form.name.value,
                    lastName: form.lastName.value,
                    email: form.email.value,
                    password: form.password.value,
                    role: 'profesor',
                    degreeName: 'Ingeniería en Informática'
                };

                try {
                    const res = await fetch('/api/auth/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(payload)
                    });

                    if (res.ok) {
                        alert('Profesor creado exitosamente.');
                        form.reset();
                    } else {
                        const errorData = await res.json();
                        alert(`Error al crear profesor: ${errorData.message || 'Error desconocido'}`);
                    }
                } catch (err) {
                    console.error('Error de red al crear profesor:', err);
                    alert('Error de red. No se pudo conectar con el servidor.');
                }
            });

            const logoutButton = document.getElementById('logout-button');
            logoutButton.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('jwtToken');
                localStorage.removeItem('userRole');
                window.location.href = '/index.html';
            });
        });
    </script>
</body>
</html>